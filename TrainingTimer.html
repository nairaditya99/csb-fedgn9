<!DOCTYPE HTML>
<html lang="en">

  <head>

    <!-- Display -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  
    <!-- Identity -->
    <title>Artisse AI Demo</title>
    <meta name="description" content="Shock is a creative multipurpose theme for building websites. It is based on Bootstrap 5 and other of the best and most up-to-date code libraries used by professional developers in the world.">
    <meta name="author" content="Codings">
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon" />
  
    <!-- Vendor CSS -->
    <link rel="stylesheet" href="assets/css/vendor/preloader.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/font-family.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/font-awesome.min.css" />  
    <link rel="stylesheet" href="assets/css/vendor/menu-engine.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/menu-grid.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/swiper.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/dynamic-slider.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/bricklayer.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/lightbox.min.css" />
    <link rel="stylesheet" href="assets/css/vendor/aos.min.css" />
  
    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/css/theme.css" />
    <link rel="stylesheet" href="assets/css/core.css" />
    <link rel="stylesheet" href="assets/css/main.css" />

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Raleway:ital,wght@1,700&display=swap');
      
      .countdown {
        font-family: 'Raleway', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 250px;
        height: 250px;
        margin: 50px auto 0; /* Add margin-top */
        background: rgb(255, 255, 255);
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        box-shadow: 20px 20px 50px rgba(0, 0, 0, 0.5);
      }
      
      .time {
        font-size: 4em;
        margin: 0 10px;
      }
      
      .countdown div:nth-child(2) {
        font-size: 3em;
      }

      </style>
  
  </head>

  <body class="shock-body">

    

    <header id="header" class="shock-header">
      <!-- Navbar -->
      <nav id="navbar" class="navbar navbar-expand-lg has-top-bar fixed-scroll hover-line-center scheme-2 primary">
        <div class="container-fluid">
          <div class="navbar-wrapper">    
            <!-- Navbar-top -->
            
            <div class="navbar-divider horizontal-line-animate"></div>    
            <!-- Navbar-bottom -->
              <div class="navbar-bottom-wrapper fixed-scroll">
                <div class="container">
                  <div class="navbar-bottom">
                      <!-- Brand -->
                      <a class="navbar-brand" href="index.html" style="margin-top: 30px">
                        <!-- <div class="site-title">Site Title</div> -->
                        <img src="assets/images/logo.svg" alt="Shock Theme" class="logo main-logo" />
                        <img src="assets/images/logo.svg" alt="Shock Theme" class="logo sticky-logo" />
                        <img src="assets/images/logo.svg" alt="Shock Theme" class="logo mobile-logo" />
                        <span class="logo-after-text" style="color: black;">Artisse AI</span>
                      </a>
                      <div class="button-wrapper" style="margin-top: 30px">
                        <a id="retrain-button" href="#" class="button shadow rounded primary white-hover button-collision" style="background: linear-gradient(130deg, rgba(248,198,58,1) 0%, rgba(216,125,221,1) 50%, rgba(89,209,233,1) 100%);">
                          <span class="button-text white black-hover">Retrain Images ↻</span>
                          
                        </a>
                        <a id="logout-button" href="#" class="button shadow rounded primary white-hover button-collision" style="background: linear-gradient(130deg, rgba(248,198,58,1) 0%, rgba(216,125,221,1) 50%, rgba(89,209,233,1) 100%);">
                          <span class="button-text white black-hover">Logout ⌧</span>
                          
                        </a>
                        
                      </div> 
                    <!-- Responsive menu toggle -->
                    
                    <!-- Navbar links -->
                    
                      <!-- Link  Do not touch, it will break the nav bar-->
                    </div>  
                  </div>
                </div>
            </div>
          </div> 
        </div>
        </nav> 
    </header>
    
    <!-- Main -->
    <main id="main" class="shock-main">

      <!-- Bold -->
      <section class="shock-section has-overlay">
        <div class="banner">
          <div class="content-wrapper">
            <!-- Intro -->
            <div class="basic-intro max-w-75 text-center">
              <h1 class="title white">
                <span class="text-1 d-block text-style-2">Your images are being trained</span>
                
              </h1>
              

              
              <div id="timer" class="countdown">
                <div id="minutes" class="time"></div>
                <div>:</div>
                <div id="seconds" class="time"></div>
              </div>
              
              
              
            </div>
          </div>
          <!-- Image -->
          <div class="image-wrapper">
            <img src="assets/images/jpg/backgroundpic.png" class="image vh-100 fit-cover" alt="This is an example description for this item." />
          </div>

          
          <!-- Overlay -->
          <div class="overlay black-75"></div>
        </div>

    
      </section>

    </main>

    <!-- Vendor JavaScript -->
    <script src="assets/js/vendor/jquery.min.js"></script>
    <script src="assets/js/vendor/imagesloaded.pkgd.min.js"></script>
    <script src="assets/js/vendor/preloader.min.js"></script>
    <script src="assets/js/vendor/inview.min.js"></script>
    <script src="assets/js/vendor/menu-engine.min.js"></script>
    <script src="assets/js/vendor/menu-grid.min.js"></script>
    <script src="assets/js/vendor/bootstrap.min.js"></script>
    <script src="assets/js/vendor/swiper.min.js"></script>
    <script src="assets/js/vendor/anime.min.js"></script>
    <script src="assets/js/vendor/dynamic-slider.min.js"></script>
    <script src="assets/js/vendor/shuffle.min.js"></script>
    <script src="assets/js/vendor/stickybits.min.js"></script>
    <script src="assets/js/vendor/bricklayer.min.js"></script>
    <script src="assets/js/vendor/lightbox.min.js"></script>
    <script src="assets/js/vendor/typed.min.js"></script>
    <script src="assets/js/vendor/progressbar.min.js"></script>
    <script src="assets/js/vendor/map-styles.min.js"></script>
    <script src="assets/js/vendor/magnetic-effect.min.js"></script>
    <script src="assets/js/vendor/gsap.min.js"></script>
    <script src="assets/js/vendor/aos.min.js"></script>
    <script src="assets/js/vendor/lax.min.js"></script>
    <script src="assets/js/vendor/cursor-effect.min.js"></script>

    <!-- Main JavaScript -->
    <script src="assets/js/main.js"></script>


    <!-- At the start, a variable extendedTime is declared to track if the countdown timer has been extended.

        The checkTrainingStatus function is an asynchronous function that makes a 
        GET request to an API endpoint. The response from the server is expected to 
        be a JSON object with a status property. If the status is 'done', the 
        countdown timer is stopped, the "Continue" button is shown, and the end 
        time of the countdown is removed from localStorage. If an error occurs during 
        the request or the status isn't 'done', an error message is displayed and the 
        countdown is stopped.

        The padTime function is a helper function that pads a time value with a leading 
        zero if it's less than 10. This is useful for displaying time values like minutes 
        and seconds.

        The script then checks if an end time for the countdown timer is stored in localStorage 
        (which could be the case if the page was refreshed). If an end time is found, 
        it's used as the countdown end time. If not, the countdown end time is set to 
        15 minutes from the current time and this end time is saved in localStorage.

        A countdown interval is then set up to run every second. This interval:

        - Gets the current time and calculates the time left until the countdown end time.
        - If the time left is less than zero, it checks if the countdown timer has already been extended.
        - If it hasn't, the countdown end time is extended by 10 minutes, localStorage is updated with the new end time, and a message is displayed to the user.
        - If it has, the countdown timer is stopped, an error message is displayed, and the countdown end time is removed from localStorage.
        - If the time left is not less than zero, it calculates the minutes and seconds remaining and updates the countdown display on the page. It then calls checkTrainingStatus to check if the image training is done.
        - In summary, this script creates a countdown timer that initially lasts 15 minutes but can be extended once by an additional 10 minutes. It checks an API endpoint every second to see if image training is done and adjusts the countdown and page content accordingly. The countdown end time is stored in localStorage so it can persist across page refreshes.-->


    <script>
      let extendedTime = false;
    
      async function checkTrainingStatus() {
        try {
          const response = await fetch('https://api.mumuxiang.cloud/api/training_status', { //Don, need the right api link here
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
          });
      
          if (!response.ok) {
            throw new Error(`Training status check failed: ${response.statusText}`);
          }
    
          const data = await response.json();
    
          // Ensure 'status' property is present in response
          if (!data.hasOwnProperty('status')) {
            throw new Error("Invalid response from server, 'status' property missing.");
          }
          
          if (data.status === 'done') {
            clearInterval(countdown);
            document.getElementById("timer").innerHTML = '<a href="InputPrompt.html" class="button shadow rounded primary white-hover button-collision" onclick="proceed()"><span class="button-text white black-hover">Continue 🡺</span></a>';
            localStorage.removeItem('end'); // Remove end time from localStorage as it's no longer needed
          } else {
            // training is still ongoing, do nothing
          }
    
        } catch (err) {
          console.error(err);
          document.getElementById("info").innerText = "An error occurred while checking training status. Please try again later.";
          clearInterval(countdown);
        }
      }
    
      function padTime(t) {
        return t < 10 ? '0' + t : t;
      }
    
      // Check if an end time is saved in localStorage (in case of page refresh)
      let storedEndTime = localStorage.getItem('end');
      let countDownDate;
      if (storedEndTime !== null) {
        countDownDate = new Date(Number(storedEndTime));
      } else {
        countDownDate = new Date().getTime() + 15*60*1000;
        localStorage.setItem('end', countDownDate.toString()); // Store the end time in localStorage
      }
    
      let countdown = setInterval(function() {
        let now = new Date().getTime();
        let timeLeft = countDownDate - now;
    
        if (timeLeft < 0) {
          if (!extendedTime) {
            // If the timer has ended for the first time, extend the countdown by 10 minutes
            extendedTime = true;
            countDownDate = new Date().getTime() + 10*60*1000;
            localStorage.setItem('end', countDownDate.toString()); // Update the end time in localStorage
            document.getElementById("info").innerText = "Training is taking longer than expected. Extending the timer by 10 minutes.";
          } else {
            // If the timer has ended for the second time, stop the countdown and show an error message
            clearInterval(countdown);
            document.getElementById("info").innerText = "Training is taking too long. Please try again later.";
            localStorage.removeItem('end'); // Remove end time from localStorage as it's no longer needed
          }
        } else {
          let minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
          let seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
      
          document.getElementById("minutes").innerHTML = padTime(minutes);
          document.getElementById("seconds").innerHTML = padTime(seconds);
          checkTrainingStatus();
        }
      }, 1000);

      function proceed() {
      localStorage.removeItem('end'); // Remove end time from localStorage as it's no longer needed
      }
    </script>
    

  </body>
</html>